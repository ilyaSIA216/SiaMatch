<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SiaMatch - –û—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 30px;
            background: #f0f0f0;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            border-bottom: 2px solid #4CAF50;
            padding-bottom: 10px;
        }
        .storage-info {
            background: #E3F2FD;
            padding: 20px;
            border-radius: 5px;
            margin: 20px 0;
        }
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        .btn-danger {
            background: #f44336;
            color: white;
        }
        .btn-warning {
            background: #FF9800;
            color: white;
        }
        .btn-success {
            background: #4CAF50;
            color: white;
        }
        .log {
            background: #f9f9f9;
            border: 1px solid #ddd;
            padding: 15px;
            margin-top: 20px;
            border-radius: 5px;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üßπ –û—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö SiaMatch</h1>
        
        <div class="storage-info">
            <h3>–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:</h3>
            <div id="storage-stats">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        </div>
        
        <h3>–û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö:</h3>
        <button class="btn btn-warning" onclick="removeOldPhotos()">
            üóëÔ∏è –£–¥–∞–ª–∏—Ç—å —Ñ–æ—Ç–æ —Å—Ç–∞—Ä—à–µ 1 –¥–Ω—è
        </button>
        <button class="btn btn-warning" onclick="removeApprovedApplications()">
            ‚úÖ –£–¥–∞–ª–∏—Ç—å –æ–¥–æ–±—Ä–µ–Ω–Ω—ã–µ –∑–∞—è–≤–∫–∏
        </button>
        <button class="btn btn-warning" onclick="removeRejectedApplications()">
            ‚ùå –£–¥–∞–ª–∏—Ç—å –æ—Ç–∫–ª–æ–Ω–µ–Ω–Ω—ã–µ –∑–∞—è–≤–∫–∏
        </button>
        
        <h3>–≠–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞:</h3>
        <button class="btn btn-danger" onclick="removeAllPhotos()">
            üì∏ –£–¥–∞–ª–∏—Ç—å –í–°–ï —Ñ–æ—Ç–æ
        </button>
        <button class="btn btn-danger" onclick="keepOnlyLastWeek()">
            ‚è∞ –û—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω—é—é –Ω–µ–¥–µ–ª—é
        </button>
        
        <h3>–ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞:</h3>
        <button class="btn btn-danger" onclick="clearAllButActive()">
            üöÄ –û—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        </button>
        <button class="btn btn-danger" onclick="clearEverything()">
            üíÄ –û–ß–ò–°–¢–ò–¢–¨ –í–°–Å
        </button>
        
        <button class="btn btn-success" onclick="backupData()" style="margin-top: 30px;">
            üíæ –°–¥–µ–ª–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é
        </button>
        
        <div class="log" id="log"></div>
    </div>

    <script>
        function log(message) {
            const logElement = document.getElementById('log');
            logElement.innerHTML = message + '\n' + logElement.innerHTML;
            console.log(message);
        }
        
        function updateStats() {
            let stats = 'üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:\n\n';
            
            // –ó–∞—è–≤–∫–∏
            try {
                const stored = localStorage.getItem('sia_pending_users');
                if (stored) {
                    const apps = JSON.parse(stored);
                    const sizeMB = (stored.length / 1024 / 1024).toFixed(2);
                    
                    const pending = apps.filter(a => a.status === 'pending').length;
                    const approved = apps.filter(a => a.status === 'approved').length;
                    const rejected = apps.filter(a => a.status === 'rejected').length;
                    
                    stats += `–ó–∞—è–≤–∫–∏: ${apps.length} —à—Ç (${sizeMB} MB)\n`;
                    stats += `  ‚Ä¢ –ù–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ: ${pending}\n`;
                    stats += `  ‚Ä¢ –û–¥–æ–±—Ä–µ–Ω–æ: ${approved}\n`;
                    stats += `  ‚Ä¢ –û—Ç–∫–ª–æ–Ω–µ–Ω–æ: ${rejected}\n\n`;
                    
                    // –§–æ—Ç–æ
                    let photoCount = 0;
                    let photoSize = 0;
                    apps.forEach(app => {
                        if (app.mainPhoto && app.mainPhoto.length > 100) {
                            photoCount++;
                            photoSize += app.mainPhoto.length;
                        }
                        if (app.selfie && app.selfie.length > 100) {
                            photoCount++;
                            photoSize += app.selfie.length;
                        }
                    });
                    
                    stats += `–§–æ—Ç–æ: ${photoCount} —à—Ç (${(photoSize / 1024 / 1024).toFixed(2)} MB)\n`;
                } else {
                    stats += '–ó–∞—è–≤–æ–∫ –Ω–µ—Ç\n\n';
                }
            } catch (e) {
                stats += '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞—è–≤–æ–∫\n\n';
            }
            
            // –ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
            try {
                const active = localStorage.getItem('sia_active_users');
                if (active) {
                    const users = JSON.parse(active);
                    stats += `–ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏: ${users.length}\n`;
                }
            } catch (e) {
                // –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º
            }
            
            document.getElementById('storage-stats').innerHTML = stats.replace(/\n/g, '<br>');
        }
        
        function removeOldPhotos() {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —Ñ–æ—Ç–æ –∏–∑ –∑–∞—è–≤–æ–∫ —Å—Ç–∞—Ä—à–µ 1 –¥–Ω—è?')) return;
            
            try {
                const stored = localStorage.getItem('sia_pending_users');
                if (!stored) {
                    log('–ù–µ—Ç –∑–∞—è–≤–æ–∫');
                    return;
                }
                
                const apps = JSON.parse(stored);
                const oneDayAgo = new Date();
                oneDayAgo.setDate(oneDayAgo.getDate() - 1);
                
                let removed = 0;
                const cleaned = apps.map(app => {
                    try {
                        const appDate = new Date(app.submittedAt);
                        if (appDate < oneDayAgo) {
                            if (app.mainPhoto && app.mainPhoto.length > 100) {
                                app.mainPhoto = '[—É–¥–∞–ª–µ–Ω–æ]';
                                removed++;
                            }
                            if (app.selfie && app.selfie.length > 100) {
                                app.selfie = '[—É–¥–∞–ª–µ–Ω–æ]';
                                removed++;
                            }
                        }
                    } catch (e) {
                        // –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ –¥–∞—Ç—ã
                    }
                    return app;
                });
                
                localStorage.setItem('sia_pending_users', JSON.stringify(cleaned));
                log(`‚úÖ –£–¥–∞–ª–µ–Ω–æ —Ñ–æ—Ç–æ –∏–∑ ${removed} –∑–∞—è–≤–æ–∫`);
                updateStats();
                
            } catch (e) {
                log(`‚ùå –û—à–∏–±–∫–∞: ${e.message}`);
            }
        }
        
        function removeApprovedApplications() {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å –≤—Å–µ –æ–¥–æ–±—Ä–µ–Ω–Ω—ã–µ –∑–∞—è–≤–∫–∏?')) return;
            
            try {
                const stored = localStorage.getItem('sia_pending_users');
                if (!stored) {
                    log('–ù–µ—Ç –∑–∞—è–≤–æ–∫');
                    return;
                }
                
                const apps = JSON.parse(stored);
                const pending = apps.filter(app => app.status !== 'approved');
                
                localStorage.setItem('sia_pending_users', JSON.stringify(pending));
                log(`‚úÖ –£–¥–∞–ª–µ–Ω–æ –æ–¥–æ–±—Ä–µ–Ω–Ω—ã—Ö –∑–∞—è–≤–æ–∫: ${apps.length - pending.length}`);
                updateStats();
                
            } catch (e) {
                log(`‚ùå –û—à–∏–±–∫–∞: ${e.message}`);
            }
        }
        
        function removeAllPhotos() {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å –í–°–ï —Ñ–æ—Ç–æ –∏–∑ –≤—Å–µ—Ö –∑–∞—è–≤–æ–∫?')) return;
            
            try {
                const stored = localStorage.getItem('sia_pending_users');
                if (!stored) {
                    log('–ù–µ—Ç –∑–∞—è–≤–æ–∫');
                    return;
                }
                
                const apps = JSON.parse(stored);
                let removed = 0;
                
                const cleaned = apps.map(app => {
                    if (app.mainPhoto) {
                        app.mainPhoto = '';
                        removed++;
                    }
                    if (app.selfie) {
                        app.selfie = '';
                        removed++;
                    }
                    return app;
                });
                
                localStorage.setItem('sia_pending_users', JSON.stringify(cleaned));
                log(`‚úÖ –£–¥–∞–ª–µ–Ω–æ —Ñ–æ—Ç–æ: ${removed}`);
                updateStats();
                
            } catch (e) {
                log(`‚ùå –û—à–∏–±–∫–∞: ${e.message}`);
            }
        }
        
        function backupData() {
            try {
                const data = {
                    timestamp: new Date().toISOString(),
                    sia_pending_users: localStorage.getItem('sia_pending_users'),
                    sia_active_users: localStorage.getItem('sia_active_users'),
                    sia_current_user: localStorage.getItem('sia_current_user')
                };
                
                const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `siamatch-backup-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                log('‚úÖ –†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è —Å–æ–∑–¥–∞–Ω–∞');
                
            } catch (e) {
                log(`‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏: ${e.message}`);
            }
        }
        
        function clearEverything() {
            if (!confirm('üíÄ –¢–û–ß–ù–û –û–ß–ò–°–¢–ò–¢–¨ –í–°–ï –î–ê–ù–ù–´–ï?\n\n–≠—Ç–æ —É–¥–∞–ª–∏—Ç –í–°–ï –∑–∞—è–≤–∫–∏, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏!\n\n–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!')) return;
            
            localStorage.clear();
            log('‚ö†Ô∏è –í–°–ï –î–ê–ù–ù–´–ï –û–ß–ò–©–ï–ù–´');
            updateStats();
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        window.addEventListener('load', () => {
            updateStats();
        });
    </script>
</body>
</html>
