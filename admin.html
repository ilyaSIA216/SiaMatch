<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SiaMatch - –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å</title>
    <link rel="stylesheet" href="styles/common.css">
    <link rel="stylesheet" href="styles/admin.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            background: linear-gradient(135deg, #1a237e, #283593);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="admin-container" id="admin-container">
            <!-- –ó–∞–≥–ª—É—à–∫–∞ –ø–æ–∫–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è -->
            <div id="loading" style="text-align: center; padding: 100px;">
                <div style="font-size: 48px; color: #4CAF50; margin-bottom: 20px;">‚è≥</div>
                <div style="color: #666;">–ó–∞–≥—Ä—É–∑–∫–∞ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏...</div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Ñ–æ—Ç–æ -->
    <div id="photo-modal" class="photo-modal">
        <button class="close-modal" onclick="closePhotoModal()">√ó</button>
        <img id="modal-image" src="" alt="–£–≤–µ–ª–∏—á–µ–Ω–Ω–æ–µ —Ñ–æ—Ç–æ">
    </div>

    <script>
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∞–¥–º–∏–Ω–∞
        function checkAdminAuth() {
            const session = localStorage.getItem('sia_admin_session');
            const loginTime = localStorage.getItem('sia_admin_login_time');
            
            if (!session || session !== 'active') {
                window.location.href = 'admin-login.html';
                return false;
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ —Å–µ—Å—Å–∏–∏ (8 —á–∞—Å–æ–≤)
            const loginDate = new Date(loginTime);
            const now = new Date();
            const hoursDiff = (now - loginDate) / (1000 * 60 * 60);
            
            if (hoursDiff > 8) {
                localStorage.removeItem('sia_admin_session');
                localStorage.removeItem('sia_admin_login_time');
                window.location.href = 'admin-login.html';
                return false;
            }
            
            return true;
        }
        
        // –û—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
        function initAdminPanel() {
            if (!checkAdminAuth()) return;
            
            // –ó–ê–ì–†–£–ñ–ê–ï–ú –î–ê–ù–ù–´–ï –° –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–ï–ú
            let pendingUsers = [];
            
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–æ–≤—É—é —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏
            if (typeof loadPendingApplicationsWithFallback === 'function') {
                pendingUsers = loadPendingApplicationsWithFallback();
            } else {
                // –°—Ç–∞—Ä—ã–π —Å–ø–æ—Å–æ–± –∫–∞–∫ –∑–∞–ø–∞—Å–Ω–æ–π
                try {
                    const stored = localStorage.getItem('sia_pending_users');
                    console.log('–ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ, –¥–ª–∏–Ω–∞:', stored?.length || 0);
                    
                    if (stored && stored !== 'undefined' && stored !== 'null' && stored.trim() !== '') {
                        pendingUsers = JSON.parse(stored);
                        console.log('–£—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ –∑–∞—è–≤–æ–∫:', pendingUsers.length);
                    } else {
                        console.log('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –∑–∞—è–≤–∫–∞—Ö –∏–ª–∏ undefined');
                    }
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö:', error);
                    pendingUsers = [];
                }
            }
            
            // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
            const stats = {
                pending: pendingUsers.filter(u => u.status === 'pending').length,
                approved: pendingUsers.filter(u => u.status === 'approved').length,
                rejected: pendingUsers.filter(u => u.status === 'rejected').length,
                total: pendingUsers.length
            };
            
            console.log('üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:', stats);
            console.log('üìã –í—Å–µ –∑–∞—è–≤–∫–∏:', pendingUsers.map(app => `${app.name} (${app.status})`));
            
            // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è HTML
            document.getElementById('admin-container').innerHTML = `
                <div class="admin-header">
                    <div class="admin-title">
                        <i class="fas fa-shield-alt"></i>SiaMatch Admin Panel
                    </div>
                    <div class="admin-info">
                        <div>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</div>
                        <div style="display: flex; gap: 10px;">
                            <button class="btn" style="background: #2196F3; color: white; padding: 8px 15px;" 
                                    onclick="if(typeof repairMobileData === 'function') { repairMobileData(); setTimeout(() => window.location.reload(), 1000); } else alert('–§—É–Ω–∫—Ü–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞')">
                                <i class="fas fa-sync-alt"></i> –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
                            </button>
                            <button class="logout-btn" onclick="logoutAdmin()">
                                <i class="fas fa-sign-out-alt"></i> –í—ã–π—Ç–∏
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value">${stats.total}</div>
                        <div class="stat-label">–í—Å–µ–≥–æ –∑–∞—è–≤–æ–∫</div>
                    </div>
                    <div class="stat-card pending">
                        <div class="stat-value">${stats.pending}</div>
                        <div class="stat-label">–ù–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ</div>
                    </div>
                    <div class="stat-card approved">
                        <div class="stat-value">${stats.approved}</div>
                        <div class="stat-label">–û–¥–æ–±—Ä–µ–Ω–æ</div>
                    </div>
                    <div class="stat-card rejected">
                        <div class="stat-value">${stats.rejected}</div>
                        <div class="stat-label">–û—Ç–∫–ª–æ–Ω–µ–Ω–æ</div>
                    </div>
                </div>
                
                <div class="admin-tabs">
                    <button class="tab-btn active" onclick="showTab('pending')">
                        <i class="fas fa-clock"></i>–ù–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ (${stats.pending})
                    </button>
                    <button class="tab-btn" onclick="showTab('approved')">
                        <i class="fas fa-check-circle"></i>–û–¥–æ–±—Ä–µ–Ω–Ω—ã–µ (${stats.approved})
                    </button>
                    <button class="tab-btn" onclick="showTab('rejected')">
                        <i class="fas fa-times-circle"></i>–û—Ç–∫–ª–æ–Ω–µ–Ω–Ω—ã–µ (${stats.rejected})
                    </button>
                    <button class="tab-btn" onclick="showTab('logs')">
                        <i class="fas fa-history"></i>–õ–æ–≥–∏ –¥–æ—Å—Ç—É–ø–∞
                    </button>
                </div>
                
                <div id="pending-tab" class="tab-content active">
                    <div class="search-box">
                        <input type="text" id="search-pending" placeholder="–ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏ –∏–ª–∏ –≥–æ—Ä–æ–¥—É..." onkeyup="searchApplications('pending')">
                    </div>
                    <div class="applications-list" id="pending-list">
                        <!-- –°–ø–∏—Å–æ–∫ –∑–∞—è–≤–æ–∫ –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ -->
                    </div>
                </div>
                
                <div id="approved-tab" class="tab-content">
                    <div class="search-box">
                        <input type="text" id="search-approved" placeholder="–ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏ –∏–ª–∏ –≥–æ—Ä–æ–¥—É..." onkeyup="searchApplications('approved')">
                    </div>
                    <div class="applications-list" id="approved-list">
                        <!-- –°–ø–∏—Å–æ–∫ –æ–¥–æ–±—Ä–µ–Ω–Ω—ã—Ö -->
                    </div>
                </div>
                
                <div id="rejected-tab" class="tab-content">
                    <div class="search-box">
                        <input type="text" id="search-rejected" placeholder="–ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏ –∏–ª–∏ –≥–æ—Ä–æ–¥—É..." onkeyup="searchApplications('rejected')">
                    </div>
                    <div class="applications-list" id="rejected-list">
                        <!-- –°–ø–∏—Å–æ–∫ –æ—Ç–∫–ª–æ–Ω–µ–Ω–Ω—ã—Ö -->
                    </div>
                </div>
                
                <div id="logs-tab" class="tab-content">
                    <h3>–õ–æ–≥–∏ –≤—Ö–æ–¥–∞ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h3>
                    <div class="logs-container" id="logs-list">
                        <!-- –õ–æ–≥–∏ –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
                    </div>
                </div>
            `;
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –≤ —Ç–∞–±—ã
            loadApplications('pending');
            loadApplications('approved');
            loadApplications('rejected');
            loadLogs();
            
            // –°–∫—Ä—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É (–±–µ–∑–æ–ø–∞—Å–Ω–æ)
            const loadingElement = document.getElementById('loading');
            if (loadingElement) {
                loadingElement.style.display = 'none';
            } else {
                console.log('‚ö†Ô∏è –≠–ª–µ–º–µ–Ω—Ç loading –Ω–µ –Ω–∞–π–¥–µ–Ω');
            }
            
            // –ï—Å–ª–∏ –Ω–µ—Ç –∑–∞—è–≤–æ–∫, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
            if (stats.total === 0) {
                const pendingList = document.getElementById('pending-list');
                pendingList.innerHTML = `
                    <div class="no-data">
                        <i class="fas fa-inbox"></i>
                        <p>–ù–µ—Ç –∑–∞—è–≤–æ–∫ –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É</p>
                        <p style="font-size: 14px; color: #888; margin-top: 10px;">
                            –ü–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∞–Ω–∫–µ—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º, –æ–Ω–∞ –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å
                        </p>
                    </div>
                `;
            }
        }
        
        function showTab(tabName) {
            // –°–∫—Ä—ã—Ç—å –≤—Å–µ —Ç–∞–±—ã
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // –ü–æ–∫–∞–∑–∞—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ç–∞–±
            document.getElementById(tabName + '-tab').classList.add('active');
            event.target.classList.add('active');
            
            // –ï—Å–ª–∏ —ç—Ç–æ –ª–æ–≥–∏, –æ–±–Ω–æ–≤–∏—Ç—å –∏—Ö
            if (tabName === 'logs') {
                loadLogs();
            }
        }
        
        function loadApplications(status) {
            let pendingUsers = [];
            try {
                const stored = localStorage.getItem('sia_pending_users');
                if (stored && stored !== 'undefined') {
                    pendingUsers = JSON.parse(stored);
                }
            } catch (e) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∑–∞—è–≤–æ–∫:', e);
                pendingUsers = [];
            }
            
            const containerId = status + '-list';
            const container = document.getElementById(containerId);
            
            const filteredUsers = pendingUsers.filter(user => user.status === status);
            
            if (filteredUsers.length === 0) {
                container.innerHTML = `
                    <div class="no-data">
                        <i class="fas fa-inbox"></i>
                        <p>–ù–µ—Ç –∑–∞—è–≤–æ–∫ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "${getStatusText(status)}"</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            filteredUsers.forEach(user => {
                const timeAgo = getTimeAgo(user.submittedAt);
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ñ–æ—Ç–æ
                const hasMainPhoto = user.mainPhoto || user.hasMainPhoto;
                const hasSelfie = user.selfie || user.hasSelfie;
                
                html += `
                    <div class="application-card ${status}" data-name="${user.name.toLowerCase()}" data-city="${user.city.toLowerCase()}">
                        <div class="application-header">
                            <div class="application-title">
                                ${user.name}, ${user.age} –ª–µ—Ç
                                <span class="status-badge status-${status}">${getStatusText(status)}</span>
                            </div>
                            <div style="color: #888; font-size: 14px;">
                                ${timeAgo}
                            </div>
                        </div>
                        
                        <div class="application-meta">
                            <div><i class="fas fa-user"></i> ${user.gender === 'male' ? '–ú—É–∂—á–∏–Ω–∞' : '–ñ–µ–Ω—â–∏–Ω–∞'}</div>
                            <div><i class="fas fa-city"></i> ${user.city}</div>
                            <div><i class="fas fa-calendar"></i> ${new Date(user.submittedAt).toLocaleDateString()}</div>
                        </div>
                        
                        <div class="application-bio">
                            ${user.bio || '–û–ø–∏—Å–∞–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç'}
                        </div>
                        
                        ${(hasMainPhoto || hasSelfie) ? `
                        <div class="application-photos">
                            ${hasMainPhoto ? `
                            <div class="photo-container">
                                <img src="${user.mainPhoto || 'https://via.placeholder.com/150?text=–§–æ—Ç–æ+–µ—Å—Ç—å+–Ω–æ+–Ω–µ+–∑–∞–≥—Ä—É–∂–µ–Ω–æ'}" 
                                     alt="–û—Å–Ω–æ–≤–Ω–æ–µ —Ñ–æ—Ç–æ" 
                                     onclick="showPhotoModal('${user.mainPhoto || ''}')">
                                <div class="photo-label">–û—Å–Ω–æ–≤–Ω–æ–µ —Ñ–æ—Ç–æ</div>
                            </div>
                            ` : ''}
                            
                            ${hasSelfie ? `
                            <div class="photo-container">
                                <img src="${user.selfie || 'https://via.placeholder.com/150?text=–°–µ–ª—Ñ–∏+–µ—Å—Ç—å+–Ω–æ+–Ω–µ+–∑–∞–≥—Ä—É–∂–µ–Ω–æ'}" 
                                     alt="–°–µ–ª—Ñ–∏" 
                                     onclick="showPhotoModal('${user.selfie || ''}')">
                                <div class="photo-label">–°–µ–ª—Ñ–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏</div>
                            </div>
                            ` : ''}
                        </div>
                        ` : '<p style="color: #888; font-size: 14px;">–§–æ—Ç–æ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã</p>'}
                        
                        ${status === 'pending' ? `
                        <div class="action-buttons">
                            <button class="btn btn-approve" onclick="approveApplication(${user.id})">
                                <i class="fas fa-check"></i> –û–¥–æ–±—Ä–∏—Ç—å
                            </button>
                            <button class="btn btn-reject" onclick="rejectApplication(${user.id})">
                                <i class="fas fa-times"></i> –û—Ç–∫–ª–æ–Ω–∏—Ç—å
                            </button>
                            <button class="btn btn-view" onclick="viewApplication(${user.id})">
                                <i class="fas fa-eye"></i> –ü–æ–¥—Ä–æ–±–Ω–µ–µ
                            </button>
                        </div>
                        ` : `
                        <div class="action-buttons">
                            <button class="btn btn-view" onclick="viewApplication(${user.id})">
                                <i class="fas fa-eye"></i> –ü–æ–¥—Ä–æ–±–Ω–µ–µ
                            </button>
                            ${status === 'approved' ? `
                            <button class="btn" style="background: #9C27B0; color: white;" onclick="sendToSwipes(${user.id})">
                                <i class="fas fa-heart"></i> –í —Å–≤–∞–π–ø—ã
                            </button>
                            ` : ''}
                        </div>
                        `}
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        function searchApplications(status) {
            const searchTerm = document.getElementById(`search-${status}`).value.toLowerCase();
            const cards = document.querySelectorAll(`#${status}-list .application-card`);
            
            cards.forEach(card => {
                const name = card.dataset.name;
                const city = card.dataset.city;
                
                if (name.includes(searchTerm) || city.includes(searchTerm)) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }
        
        function loadLogs() {
            const logs = JSON.parse(localStorage.getItem('sia_admin_log') || '[]');
            const container = document.getElementById('logs-list');
            
            if (logs.length === 0) {
                container.innerHTML = '<div class="no-data"><p>–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π –≤ –ª–æ–≥–∞—Ö</p></div>';
                return;
            }
            
            let html = '';
            logs.reverse().forEach(log => { // –ù–æ–≤—ã–µ —Å–≤–µ—Ä—Ö—É
                const time = new Date(log.timestamp).toLocaleString();
                html += `
                    <div class="log-entry ${log.success ? 'success' : 'failed'}">
                        <div><span class="log-time">${time}</span> - 
                        <span class="log-message">${log.success ? '‚úÖ –£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥' : '‚ùå –ù–µ—É–¥–∞—á–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ –≤—Ö–æ–¥–∞'}</span></div>
                        <div style="font-size: 10px; color: #888; margin-top: 5px;">
                            IP: ${log.ip} | –ü–∞—Ä–æ–ª—å: ${log.attemptedPassword}
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        function approveApplication(userId) {
            if (!confirm('–û–¥–æ–±—Ä–∏—Ç—å —ç—Ç—É –∑–∞—è–≤–∫—É?')) return;
            
            updateApplicationStatus(userId, 'approved');
            showTab('pending');
            setTimeout(() => initAdminPanel(), 500); // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        }
        
        function rejectApplication(userId) {
            const reason = prompt('–£–∫–∞–∂–∏—Ç–µ –ø—Ä–∏—á–∏–Ω—É –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ):');
            updateApplicationStatus(userId, 'rejected', reason);
            showTab('pending');
            setTimeout(() => initAdminPanel(), 500);
        }
        
        function updateApplicationStatus(userId, newStatus, reason = '') {
            let pendingUsers = [];
            try {
                pendingUsers = JSON.parse(localStorage.getItem('sia_pending_users') || '[]');
            } catch (e) {
                pendingUsers = [];
            }
            
            const userIndex = pendingUsers.findIndex(u => u.id === userId);
            
            if (userIndex !== -1) {
                pendingUsers[userIndex].status = newStatus;
                pendingUsers[userIndex].moderatedAt = new Date().toISOString();
                pendingUsers[userIndex].moderator = '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä';
                if (reason) {
                    pendingUsers[userIndex].rejectionReason = reason;
                }
                
                localStorage.setItem('sia_pending_users', JSON.stringify(pendingUsers));
                
                // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–¥–æ–±—Ä–µ–Ω - –¥–æ–±–∞–≤–ª—è–µ–º –≤ –∞–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
                if (newStatus === 'approved') {
                    const user = pendingUsers[userIndex];
                    let activeUsers = JSON.parse(localStorage.getItem('sia_active_users') || '[]');
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ—Ç –ª–∏ —É–∂–µ —Ç–∞–∫–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –∞–∫—Ç–∏–≤–Ω—ã—Ö
                    const userExists = activeUsers.some(u => u.id === userId);
                    
                    if (!userExists) {
                        activeUsers.push({
                            id: user.id,
                            name: user.name,
                            age: user.age,
                            city: user.city,
                            gender: user.gender,
                            bio: user.bio || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å SiaMatch',
                            photo: user.mainPhoto || 'https://randomuser.me/api/portraits/men/' + (Math.floor(Math.random() * 50) + 1) + '.jpg'
                        });
                        localStorage.setItem('sia_active_users', JSON.stringify(activeUsers));
                    }
                }
                
                alert(`‚úÖ –ó–∞—è–≤–∫–∞ ${getStatusText(newStatus)}!`);
            } else {
                alert('‚ùå –ó–∞—è–≤–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!');
            }
        }
        
        function viewApplication(userId) {
            const pendingUsers = JSON.parse(localStorage.getItem('sia_pending_users') || '[]');
            const user = pendingUsers.find(u => u.id === userId);
            
            if (user) {
                let details = `üìã –ó–ê–Ø–í–ö–ê #${user.applicationId || user.id}\n\n`;
                details += `üë§ –ò–º—è: ${user.name}\n`;
                details += `üéÇ –í–æ–∑—Ä–∞—Å—Ç: ${user.age} –ª–µ—Ç\n`;
                details += `üë´ –ü–æ–ª: ${user.gender === 'male' ? '–ú—É–∂—á–∏–Ω–∞' : '–ñ–µ–Ω—â–∏–Ω–∞'}\n`;
                details += `üèôÔ∏è –ì–æ—Ä–æ–¥: ${user.city}\n`;
                details += `üìÖ –î–∞—Ç–∞ –ø–æ–¥–∞—á–∏: ${new Date(user.submittedAt).toLocaleString()}\n`;
                details += `üìä –°—Ç–∞—Ç—É—Å: ${getStatusText(user.status)}\n\n`;
                
                if (user.bio) details += `üìù –û–ø–∏—Å–∞–Ω–∏–µ: ${user.bio}\n\n`;
                
                if (user.moderatedAt) {
                    details += `‚úÖ –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ: ${new Date(user.moderatedAt).toLocaleString()}\n`;
                    details += `üë®‚Äçüíº –ú–æ–¥–µ—Ä–∞—Ç–æ—Ä: ${user.moderator || '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä'}\n`;
                }
                
                if (user.rejectionReason) {
                    details += `‚ùå –ü—Ä–∏—á–∏–Ω–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è: ${user.rejectionReason}\n`;
                }
                
                alert(details);
            }
        }
        
        function sendToSwipes(userId) {
            alert('‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–±–∞–≤–ª–µ–Ω –≤ —Å–≤–∞–π–ø—ã!');
        }
        
        function showPhotoModal(photoUrl) {
            if (photoUrl && photoUrl.includes('http')) {
                document.getElementById('modal-image').src = photoUrl;
                document.getElementById('photo-modal').style.display = 'flex';
            } else {
                alert('–§–æ—Ç–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞');
            }
        }
        
        function closePhotoModal() {
            document.getElementById('photo-modal').style.display = 'none';
        }
        
        function getStatusText(status) {
            const statusMap = {
                'pending': '–ù–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ',
                'approved': '–û–¥–æ–±—Ä–µ–Ω–æ',
                'rejected': '–û—Ç–∫–ª–æ–Ω–µ–Ω–æ'
            };
            return statusMap[status] || status;
        }
        
        function getTimeAgo(dateString) {
            if (!dateString) return '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
            
            try {
                const date = new Date(dateString);
                const now = new Date();
                const diffMs = now - date;
                const diffMins = Math.floor(diffMs / 60000);
                const diffHours = Math.floor(diffMs / 3600000);
                const diffDays = Math.floor(diffMs / 86400000);
                
                if (diffMins < 60) {
                    return `${diffMins} –º–∏–Ω –Ω–∞–∑–∞–¥`;
                } else if (diffHours < 24) {
                    return `${diffHours} —á –Ω–∞–∑–∞–¥`;
                } else {
                    return `${diffDays} –¥–Ω –Ω–∞–∑–∞–¥`;
                }
            } catch (e) {
                return '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
            }
        }
        
        function logoutAdmin() {
            localStorage.removeItem('sia_admin_session');
            localStorage.removeItem('sia_admin_login_time');
            window.location.href = 'admin-login.html';
        }
        
        // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', function() {
            // –î–∞–µ–º –≤—Ä–µ–º—è –Ω–∞ –∑–∞–≥—Ä—É–∑–∫—É utils.js
            setTimeout(initAdminPanel, 100);
        });
        
        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ —Ñ–æ—Ç–æ
        document.addEventListener('click', function(e) {
            const modal = document.getElementById('photo-modal');
            if (modal && e.target === modal) {
                closePhotoModal();
            }
        });
        
        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø–æ Esc
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closePhotoModal();
            }
        });
    </script>
</body>
</html>
