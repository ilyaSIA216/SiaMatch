<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SiaMatch - –¢–µ—Å—Ç –º–æ–±–∏–ª—å–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
        }
        .btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
            width: 100%;
        }
        .btn-blue { background: #2196F3; }
        .btn-red { background: #f44336; }
        
        .photo-preview {
            width: 150px;
            height: 150px;
            border: 2px dashed #ccc;
            margin: 10px;
            display: inline-block;
            text-align: center;
            line-height: 150px;
            color: #888;
            border-radius: 5px;
        }
        .photo-preview img {
            max-width: 100%;
            max-height: 100%;
            border-radius: 5px;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        
        .log {
            background: #f9f9f9;
            border: 1px solid #ddd;
            padding: 15px;
            margin-top: 20px;
            border-radius: 5px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üì± –¢–µ—Å—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å –º–æ–±–∏–ª—å–Ω–æ–≥–æ</h1>
        
        <div id="device-info"></div>
        
        <h3>1. –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</h3>
        <input type="text" id="name" placeholder="–ò–º—è" value="–¢–µ—Å—Ç –ú–æ–±–∏–ª—å–Ω—ã–π">
        <input type="number" id="age" placeholder="–í–æ–∑—Ä–∞—Å—Ç" value="25">
        <select id="city">
            <option value="–ú–æ—Å–∫–≤–∞">–ú–æ—Å–∫–≤–∞</option>
            <option value="–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥">–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥</option>
            <option value="–ö–∞–∑–∞–Ω—å">–ö–∞–∑–∞–Ω—å</option>
        </select>
        <select id="gender">
            <option value="male">–ú—É–∂—á–∏–Ω–∞</option>
            <option value="female">–ñ–µ–Ω—â–∏–Ω–∞</option>
        </select>
        <textarea id="bio" placeholder="–û —Å–µ–±–µ" rows="3">–¢–µ—Å—Ç —Å –º–æ–±–∏–ª—å–Ω–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞</textarea>
        
        <h3>2. –§–æ—Ç–æ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):</h3>
        <div style="display: flex; flex-wrap: wrap;">
            <div class="photo-preview" id="mainPhotoPreview" onclick="document.getElementById('mainPhotoInput').click()">
                üì∑ –û—Å–Ω–æ–≤–Ω–æ–µ —Ñ–æ—Ç–æ
            </div>
            <div class="photo-preview" id="selfiePreview" onclick="document.getElementById('selfieInput').click()">
                ü§≥ –°–µ–ª—Ñ–∏
            </div>
        </div>
        
        <input type="file" id="mainPhotoInput" accept="image/*" style="display: none" onchange="previewPhoto(this, 'mainPhotoPreview')">
        <input type="file" id="selfieInput" accept="image/*" style="display: none" onchange="previewPhoto(this, 'selfiePreview')">
        
        <h3>3. –û—Ç–ø—Ä–∞–≤–∫–∞:</h3>
        <button class="btn" onclick="submitTest()">
            üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é –∑–∞—è–≤–∫—É
        </button>
        <button class="btn btn-blue" onclick="submitWithoutPhotos()">
            üìÑ –ë–µ–∑ —Ñ–æ—Ç–æ
        </button>
        <button class="btn btn-blue" onclick="checkStorage()">
            üíæ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
        </button>
        <button class="btn btn-red" onclick="clearTestData()">
            üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã
        </button>
        
        <h3>4. –†–µ–∑—É–ª—å—Ç–∞—Ç:</h3>
        <div class="log" id="result"></div>
        
        <div style="margin-top: 30px; text-align: center;">
            <a href="admin.html" style="color: #2196F3; text-decoration: none;">
                üîó –û—Ç–∫—Ä—ã—Ç—å –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
            </a>
        </div>
    </div>

    <script>
        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ
        const isMobile = /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
        document.getElementById('device-info').innerHTML = `
            <div style="background: ${isMobile ? '#E8F5E9' : '#E3F2FD'}; padding: 10px; border-radius: 5px; margin-bottom: 15px;">
                üì± <strong>–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ:</strong> ${isMobile ? '–ú–æ–±–∏–ª—å–Ω–æ–µ' : '–ö–æ–º–ø—å—é—Ç–µ—Ä'}
                <br>üîç <strong>User Agent:</strong> ${navigator.userAgent.substring(0, 50)}...
            </div>
        `;
        
        let mainPhotoBase64 = '';
        let selfieBase64 = '';
        
        function previewPhoto(input, previewId) {
            const file = input.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const base64 = e.target.result;
                const preview = document.getElementById(previewId);
                
                if (previewId === 'mainPhotoPreview') {
                    mainPhotoBase64 = base64;
                } else {
                    selfieBase64 = base64;
                }
                
                preview.innerHTML = `<img src="${base64}" alt="Preview">`;
                preview.style.borderColor = '#4CAF50';
                
                logResult(`‚úÖ –§–æ—Ç–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ: ${(base64.length / 1024).toFixed(1)} KB`);
            };
            reader.readAsDataURL(file);
        }
        
        function submitTest() {
            const userData = {
                id: Date.now(),
                name: document.getElementById('name').value,
                age: parseInt(document.getElementById('age').value),
                city: document.getElementById('city').value,
                gender: document.getElementById('gender').value,
                bio: document.getElementById('bio').value,
                mainPhoto: mainPhotoBase64,
                selfie: selfieBase64
            };
            
            logResult('=== üì§ –û–¢–ü–†–ê–í–ö–ê –ó–ê–Ø–í–ö–ò ===');
            logResult(`–ò–º—è: ${userData.name}`);
            logResult(`–í–æ–∑—Ä–∞—Å—Ç: ${userData.age}`);
            logResult(`–ì–æ—Ä–æ–¥: ${userData.city}`);
            logResult(`ID: ${userData.id}`);
            logResult(`–§–æ—Ç–æ: ${userData.mainPhoto ? (userData.mainPhoto.length / 1024).toFixed(1) + ' KB' : '–Ω–µ—Ç'}`);
            logResult(`–°–µ–ª—Ñ–∏: ${userData.selfie ? (userData.selfie.length / 1024).toFixed(1) + ' KB' : '–Ω–µ—Ç'}`);
            
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º –£–ü–†–û–©–ï–ù–ù–£–Æ —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è —Ç–µ—Å—Ç–∞
            submitForModerationSimple(userData);
        }
        
        function submitWithoutPhotos() {
            const userData = {
                id: Date.now(),
                name: document.getElementById('name').value,
                age: parseInt(document.getElementById('age').value),
                city: document.getElementById('city').value,
                gender: document.getElementById('gender').value,
                bio: document.getElementById('bio').value
            };
            
            logResult('=== üì§ –û–¢–ü–†–ê–í–ö–ê –ë–ï–ó –§–û–¢–û ===');
            submitForModerationSimple(userData);
        }
        
        // –£–ü–†–û–©–ï–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –û–¢–ü–†–ê–í–ö–ò –î–õ–Ø –¢–ï–°–¢–ê
        function submitForModerationSimple(userData) {
            logResult('\nüîÑ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∑–∞—è–≤–∫–∏...');
            
            // –î–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö - –ù–ï —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–æ—Ç–æ
            if (isMobile && (userData.mainPhoto || userData.selfie)) {
                logResult('‚ö†Ô∏è –ù–∞ –º–æ–±–∏–ª—å–Ω–æ–º - —Ñ–æ—Ç–æ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –∑–∞—è–≤–∫—É');
                delete userData.mainPhoto;
                delete userData.selfie;
            }
            
            // –°–æ–∑–¥–∞–µ–º –∑–∞—è–≤–∫—É
            const application = {
                id: userData.id,
                name: userData.name || '–¢–µ—Å—Ç',
                age: userData.age || 25,
                city: userData.city || '–ú–æ—Å–∫–≤–∞',
                gender: userData.gender || 'male',
                bio: userData.bio || '–¢–µ—Å—Ç',
                status: 'pending',
                submittedAt: new Date().toISOString(),
                applicationId: 'MOB-' + Date.now().toString().slice(-8),
                hasMainPhoto: !!userData.mainPhoto,
                hasSelfie: !!userData.selfie
            };
            
            // –¢–æ–ª—å–∫–æ –¥–ª—è –∫–æ–º–ø—å—é—Ç–µ—Ä–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–æ—Ç–æ URL (–Ω–µ base64)
            if (!isMobile && userData.mainPhoto && userData.mainPhoto.startsWith('data:image')) {
                // –î–ª—è –∫–æ–º–ø—å—é—Ç–µ—Ä–∞ –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ–º base64 –≤ Blob URL –¥–ª—è —É–º–µ–Ω—å—à–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞
                application.mainPhoto = 'photo-uploaded';
            }
            if (!isMobile && userData.selfie && userData.selfie.startsWith('data:image')) {
                application.selfie = 'selfie-uploaded';
            }
            
            // –ü–æ–ª—É—á–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∑–∞—è–≤–∫–∏
            let applications = [];
            try {
                const stored = localStorage.getItem('sia_pending_users');
                if (stored && stored !== 'undefined' && stored !== 'null') {
                    applications = JSON.parse(stored);
                }
            } catch (e) {
                logResult('‚ùå –û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è: ' + e.message);
                applications = [];
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—É—é –∑–∞—è–≤–∫—É
            applications.push(application);
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º
            try {
                localStorage.setItem('sia_pending_users', JSON.stringify(applications));
                logResult(`‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ! –í—Å–µ–≥–æ –∑–∞—è–≤–æ–∫: ${applications.length}`);
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
                const verify = localStorage.getItem('sia_pending_users');
                if (verify) {
                    logResult(`‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞: ${JSON.parse(verify).length} –∑–∞—è–≤–æ–∫ –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ`);
                }
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–∞–∫–∂–µ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                localStorage.setItem('sia_current_user', JSON.stringify(userData));
                localStorage.setItem('sia_current_user_id', userData.id.toString());
                
                logResult('üéâ –ó–∞—è–≤–∫–∞ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!');
                
            } catch (e) {
                logResult(`‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ${e.message}`);
                
                // –ü—Ä–æ–±—É–µ–º —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –±–µ–∑ —Ñ–æ—Ç–æ
                try {
                    const simpleApp = { ...application };
                    delete simpleApp.mainPhoto;
                    delete simpleApp.selfie;
                    
                    const simpleApps = applications.map(app => ({
                        id: app.id,
                        name: app.name,
                        age: app.age,
                        city: app.city,
                        gender: app.gender,
                        status: app.status,
                        submittedAt: app.submittedAt,
                        applicationId: app.applicationId
                    }));
                    
                    localStorage.setItem('sia_pending_users', JSON.stringify(simpleApps));
                    logResult('‚ö†Ô∏è –°–æ—Ö—Ä–∞–Ω–µ–Ω—ã —É–ø—Ä–æ—â–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ');
                } catch (e2) {
                    logResult('‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞!');
                }
            }
        }
        
        function checkStorage() {
            logResult('=== üíæ –ü–†–û–í–ï–†–ö–ê –•–†–ê–ù–ò–õ–ò–©–ê ===');
            
            const stored = localStorage.getItem('sia_pending_users');
            if (!stored) {
                logResult('üì≠ –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –∑–∞—è–≤–∫–∞—Ö');
                return;
            }
            
            try {
                const apps = JSON.parse(stored);
                logResult(`üìä –ó–∞—è–≤–æ–∫: ${apps.length}`);
                
                apps.forEach((app, i) => {
                    const hasPhoto = app.mainPhoto || app.hasMainPhoto;
                    const hasSelfie = app.selfie || app.hasSelfie;
                    logResult(`${i+1}. ${app.name}, ${app.city} - ${app.status} ${hasPhoto ? 'üì∑' : ''}${hasSelfie ? 'ü§≥' : ''}`);
                });
                
                logResult(`üìè –†–∞–∑–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö: ${(stored.length / 1024).toFixed(1)} KB`);
                
            } catch (e) {
                logResult(`‚ùå –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞: ${e.message}`);
                logResult(`üìè –†–∞–∑–º–µ—Ä —Å—Ç—Ä–æ–∫–∏: ${stored.length} —Å–∏–º–≤–æ–ª–æ–≤`);
                logResult(`üîç –ù–∞—á–∞–ª–æ –¥–∞–Ω–Ω—ã—Ö: ${stored.substring(0, 100)}...`);
            }
        }
        
        function clearTestData() {
            if (confirm('–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ?')) {
                // –£–¥–∞–ª—è–µ–º —Ç–æ–ª—å–∫–æ –∑–∞—è–≤–∫–∏ —Å ID –±–æ–ª—å—à–µ 1000000000000 (–Ω–æ–≤—ã–µ —Ç–µ—Å—Ç—ã)
                try {
                    const stored = localStorage.getItem('sia_pending_users');
                    if (stored) {
                        const apps = JSON.parse(stored);
                        const filtered = apps.filter(app => app.id < 1000000000000); // –û—Å—Ç–∞–≤–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ
                        
                        localStorage.setItem('sia_pending_users', JSON.stringify(filtered));
                        logResult(`‚úÖ –û—á–∏—â–µ–Ω–æ —Ç–µ—Å—Ç–æ–≤—ã—Ö –∑–∞—è–≤–æ–∫: ${apps.length - filtered.length}`);
                    }
                } catch (e) {
                    logResult('‚ùå –û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏');
                }
            }
        }
        
        function logResult(message) {
            const result = document.getElementById('result');
            result.innerHTML = message + '\n' + result.innerHTML;
            console.log(message);
        }
        
        // –ê–≤—Ç–æ–ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', () => {
            checkStorage();
        });
    </script>
</body>
</html>
